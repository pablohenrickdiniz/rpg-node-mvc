var ModelRegistry=require("node-mvc/Mongo/ModelRegistry");var bcryt=require("bcrypt");var deepmerge=require("deepmerge");module.exports={req:null,config:{model:"",fields:{login:"username",password:"password"}},setUser:function(b){var a=this;a.req.session.user=b},getUser:function(){var a=this;return a.req.session.user},logout:function(){this.req.session.reset()},login:function(b,g){var i=this;var c=i.fields.login;var h=i.fields.password;var f=b[h];var d=b[c];var a=ModelRegistry.get(this.config.model);var e={};e[c]=d;a.findOne(e,function(k,l){if(k){g(new Error("Esse login n√£o existe"),{})}else{var j=l[h];bcryt.compare(f,j,function(n,m){if(n){g(new Error("Login ou senha incorretos"),{})}else{if(m){delete l[h];delete l[c];i.setUser(l);g(null,l)}}})}})},getUserData:function(){var c=this;var b=c.fields.login;var d=c.fields.password;var a={login:"",password:""};if(c.req.body[b]!=undefined){a.login=c.req.body[b]}if(c.req.body[d]!=undefined){a.password=c.req.body[d]}return a},configure:function(a){this.config=deepmerge(this.config,a)}};